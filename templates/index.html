<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Sandata — Professional Security Assessment Platform</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
  <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
  <link rel="apple-touch-icon" sizes="48x48" href="/static/favicon-48x48.png">
  
  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300;400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Icons+Round">
  <link rel="stylesheet" href="/static/style.css">
  <style>
    .advanced-alert-note {
        background-color: #2d2d2d;
        padding: 10px 15px;
        border-radius: 8px;
        color: #ffb300;
        display: none; /* Hidden by default */
        /* margin-bottom: 30px; */
    }
    .alert-danger {
        background: #ff4e4e;
        color: #ffffff;
        margin-bottom: 0px;
    }
    .alert .material-icons-round {
        font-size: 48px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <img src="/static/img/sandata_3_modified.png" alt="Sandata Logo" class="logo-icon">
        <h1>Sandata</h1>
      </div>
      <p class="subtitle">Professional Security Assessment & Compliance Testing Platform</p>
      
      <!-- User Navigation -->
      <div class="user-nav">
        {% if current_user.is_authenticated %}
          <span class="user-welcome">
            <span class="material-icons-round">account_circle</span>
            Welcome, <strong>{{ current_user.username }}</strong>
          </span>
          <a href="{{ url_for('index') }}" class="btn-nav active">
            <span class="material-icons-round">security</span>
            Scanner
          </a>
          <a href="{{ url_for('dashboard') }}" class="btn-nav">
            <span class="material-icons-round">dashboard</span>
            Dashboard
          </a>
          {% if current_user.is_admin %}
          <a href="{{ url_for('admin_panel') }}" class="btn-nav">
            <span class="material-icons-round">admin_panel_settings</span>
            Admin
          </a>
          {% endif %}
          <a href="/security_list" class="btn-nav">
            <span class="material-icons-round">list_alt</span>
            Security Audit
          </a>
          <a href="{{ url_for('logout') }}" class="btn-nav">
            <span class="material-icons-round">logout</span>
            Logout
          </a>
        {% else %}
          <a href="{{ url_for('login') }}" class="btn-nav">
            <span class="material-icons-round">login</span>
            Login
          </a>
          <a href="{{ url_for('register') }}" class="btn-nav btn-nav-primary">
            <span class="material-icons-round">person_add</span>
            Register
          </a>
        {% endif %}
      </div>
    </header>

    <!-- Legal Notice -->
    <div class="notice-card">
      <span class="material-icons-round notice-icon">gavel</span>
      <div class="notice-content">
        <strong>Legal & Ethical Notice:</strong> Use this tool ONLY on systems you own or where you have explicit written permission to test. Unauthorized scanning is illegal and unethical.
      </div>
    </div>

    <!-- Scan Controls -->
    <div class="card scan-card">
      <h2>
        <span class="material-icons-round">radar</span>
        Start Security Scan <span id="scan-type-badge" class="scan-type-badge">General</span>
      </h2>
      
      <div class="form-group">
        <label for="target">Target URL</label>
        <input 
          id="target" 
          type="url" 
          placeholder="https://example.com/checkout" 
          autocomplete="off"
        />
      </div>

      <div class="form-group">
        <label>Scan Type</label>
        <div class="scan-type-selector">
          <button class="scan-type-btn active" data-type="general">
            <span class="material-icons-round">security</span>
            <div>
              <strong>General Scan</strong>
              <small>Headers, TLS, common vulnerabilities</small>
            </div>
          </button>
          <button class="scan-type-btn" data-type="payment">
            <span class="material-icons-round">payment</span>
            <div>
              <strong>Payment Page Scan</strong>
              <small>PCI DSS, forms, payment security</small>
            </div>
          </button>
          <button class="scan-type-btn" data-type="advanced">
            <span class="material-icons-round">science</span>
            <div>
              <strong>Advanced Scan</strong>
              <small>ONLY selected advanced tests (no general checks)</small>
            </div>
          </button>
        </div>
      </div>

      <button id="start-scan" class="btn-primary">
        <span class="material-icons-round">play_arrow</span>
        Start Scan
      </button>
      <!-- Hidden alert note -->
        <div style="display: none; margin-top: 1rem;" class="advanced-alert-note alert alert-danger alert-dismissible shadow-soft fade show" role="alert">
            <span class="material-icons-round">warning</span> 
            <span class="alert-inner--text">
                <strong>These modes are MORE INVASIVE</strong> and may trigger security systems like WAF (Web Application Firewall) or IDS (Intrusion Detection System).
                <br><strong>Only use with explicit written permission!</strong>
                <div id="advanced-options-list" style="margin-top: 0.5rem; text-align: left;"></div>
            </span>
        </div>
    </div>
    <!-- Status Card -->
    <div id="status" class="card status-card hidden">
      <h3>
        <span class="material-icons-round scanning">sync</span>
        Status
      </h3>
      <pre id="log"></pre>
    </div>

    <!-- Report Card -->
    <div id="report" class="card report-card hidden">
      <div class="report-header">
        <h3>
          <span class="material-icons-round">assessment</span>
          Security Report
        </h3>
        <button id="export-btn" class="btn-secondary">
          <span class="material-icons-round">download</span>
          Export JSON
        </button>
      </div>
      <div id="report-content"></div>
    </div>

    <!-- Recent Scans -->
    <div class="card history-card">
      <h3>
        <span class="material-icons-round">history</span>
        Recent Scans
      </h3>
      <div id="history-list"></div>
      <button id="load-history" class="btn-secondary">
        <span class="material-icons-round">refresh</span>
        Load History
      </button>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-top">
        <div class="footer-brand">
          <span class="material-icons-round footer-icon">verified_user</span>
          <h3>Sandata</h3>
        </div>
        <p class="footer-tagline">Professional security scanning for authorized testing</p>
        <p class="footer-warning">Always ensure you have explicit permission before scanning any system</p>
      </div>
      
      <div class="footer-divider-main"></div>
      
      <div class="footer-bottom">
        <div class="footer-copyright">
          <p>&copy; 2025 <strong>Jan Francis Israel</strong>. All rights reserved.</p>
          <div class="footer-links">
            <a href="https://janisrael.com" target="_blank" rel="noopener noreferrer">
              <span class="material-icons-round">language</span>
              janisrael.com
            </a>
            <span class="footer-separator">|</span>
            <a href="https://huggingface.co/swordfish7412" target="_blank" rel="noopener noreferrer">
              <span class="material-icons-round">hub</span>
              HuggingFace
            </a>
            <span class="footer-separator">|</span>
            <a href="https://github.com/janisrael" target="_blank" rel="noopener noreferrer">
              <span class="material-icons-round">code</span>
              GitHub
            </a>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <!-- Finding Detail Modal -->
  {% include 'finding_detail_modal.html' %}

  <script src="/static/finding_modal.js"></script>
  <script src="/static/app.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const buttons = document.querySelectorAll(".scan-type-btn");
      const advancedNote = document.querySelector(".advanced-alert-note");
      const scanTypeBadge = document.getElementById("scan-type-badge");
    
      buttons.forEach((button) => {
        button.addEventListener("click", () => {
          // Remove active state from all buttons
          buttons.forEach((btn) => btn.classList.remove("active"));
    
          // Add active state to the clicked button
          button.classList.add("active");
    
          // Get selected scan type
          const selectedType = button.getAttribute("data-type");
          console.log(`Selected scan type: ${selectedType}`);
    
          // Update the scan type badge
          const scanTypeLabel = selectedType.charAt(0).toUpperCase() + selectedType.slice(1);
          if (scanTypeBadge) {
            scanTypeBadge.textContent = scanTypeLabel;
          }
    
          // Show or hide the advanced note
          if (selectedType === "advanced") {
            advancedNote.style.display = "flex";
            updateAdvancedOptionsList(); // Update the list of enabled options
          } else {
            advancedNote.style.display = "none";
          }
    
          // Optional: call your handler function
          handleScanTypeChange(selectedType);
        });
      });
    });
    
    function handleScanTypeChange(type) {
      switch (type) {
        case "general":
          console.log("Running General Scan...");
          break;
        case "payment":
          console.log("Running Payment Page Scan...");
          break;
        case "advanced":
          console.log("Running Advanced Scan...");
          break;
      }
    }
    
    // Function to read advanced options from localStorage and display them
    function updateAdvancedOptionsList() {
  
      const listContainer = document.querySelector('#advanced-options-list');
      if (!listContainer) return;
      
      // Retrieve advanced options from localStorage
        const advancedOptionsStr = localStorage.getItem('advancedScanOptions');
        let advancedOptions = {};

        try {
        advancedOptions = advancedOptionsStr ? JSON.parse(advancedOptionsStr) : {};
        } catch (e) {
        console.error('Failed to parse advancedScanOptions:', e);
        advancedOptions = {};
        }
        console.log(advancedOptions)
        // Map of keys to human-readable names
        const optionNames = {
        sqlInjection: 'SQL Injection Testing',
        xssDetection: 'XSS Detection',
        pluginVuln: 'CMS Plugin Vulnerability Check',
        subdomainEnum: 'Subdomain Enumeration',
        portScan: 'Port Scanning',
        directoryBruteforce: 'Directory Bruteforcing',
        apiDiscovery: 'API Endpoint Discovery',
        s3BucketCheck: 'S3 Bucket Exposure Check'
        };
    
        // Filter only enabled (true) options
        const enabledOptions = Object.keys(advancedOptions)
        .filter(key => advancedOptions[key] === true)
        .map(key => optionNames[key])
        .filter(Boolean); // remove any undefined in case of mismatch

        // Render the list
     // your container
    if (enabledOptions.length > 0) {
        let html = '';
        html += '<ul style="margin: 0.5rem 0 0 1.5rem; padding: 0; text-align: left;">';
        enabledOptions.forEach(option => {
            html += `<li style="margin: 0.25rem 0;">${option}</li>`;
        });

        html += '</ul>';
        listContainer.innerHTML = html;
    } else {
    listContainer.innerHTML = `
        <p style="margin-top: 0.5rem; color: #ffcc00;">
        <strong>⚠️ No advanced tests selected!</strong> 
        Please enable at least one test in 
        <a href="/security_list" style="color: #ffcc00; text-decoration: underline;">Security Audit</a> page.
        </p>`;
    }
    }
    </script>
    
</body>
</html>

